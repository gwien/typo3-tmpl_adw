# »find« extension configuration for the Resikom index.
#

plugin.tx_find {
	# Paths for own templates and partials.
	# Most of them use symlinks to point back to the standard files provided by the extension.
	view {
		templateRootPath = EXT:tmpl_adw/Resources/Private/Templates/Extensions/find/resikom/Templates/
		partialRootPath = EXT:tmpl_adw/Resources/Private/Templates/Extensions/find/resikom/Partials/
		layoutRootPath = EXT:tmpl_adw/Resources/Private/Templates/Extensions/find/resikom/Layouts/
	}

	settings {
		# Connection setup for the Solr index.
		# Needs to be adapted / overwritten for the final configuration.
		connection {
			host = adw-dev.tc.sub.uni-goettingen.de
			port = 80
			path = /solr/resikom

			# Use a long 10 second timeout for Solr queries.
			timeout = 20
		}
		defaultQuery = *:*
		# Add a filter query to not return documents of type »gott« or »ort«
		# This will removed when project members log in with their account.
		# (See the note at the end of the configuration file for details.)
		additionalFilters >

		dataFields >

		queryFields >
		# Query field configuration
		queryFields {
			# Main query field, suppress typ »wb_berlin« and »stelle« documents.
			0 {
				id = default
				query = %s
				type = Text
				noescape = 1
				autocomplete = 1
				autocompleteDictionary = suggest
			}
		}

		# Sort by the sort field in the documents.
		# These have differing content depending on their type.
		sort >

		# Fields to use for displaying the result list.
		standardFields {
			title = section-title
			snippet = content
		}

		# Facet configuration.
		facets {
			# The typ facet is used for the tabs at the top.
			# It comes with explicit facet queries for the types we want to display.
			# Only the two types we want to display by default are configured here.
			# The remaining types only appear for logged in users and are configured
			# at the end of the file.
			10 {
				id = id
				excludeOwnFilter = 1
				type = Tabs
				field = type
				hidden = 0

				selectedByDefault {
					handbuch1 = 1
				}
				facetQuery {
					10 {
						id = handbuch1
						query = book:I
					}
					20 {
						id = handbuch2
						query = book:II
					}
					30 {
						id = handbuch3
						query = book:III
					}
					40 {
						id = handbuch4
						query = book:IV
					}
				}
			}
			# There are 8 Chassinat volumes, show all of them.
			20 >
			# In case documents on other temples than Edfu are included,
			# add a facet with the temple name.
			30 >
			40 >
			50 >
			130 >
		}

		# Configure the fields to highlight.
		highlight {
			default {
				fields {
					f1 = content
				}
				# Use a really large fragsize as we have to operate on the results with
				# regular expressions which only works reliably if we are guaranteed to
				# have all opening and closing transliteration brackets in our
				# highlight string
				fragsize = 5000
				useQueryTerms = 0
				useFacetTerms = 0
				alternateFields >
			}
			detail {
				f51 = content
			}
		}

		# Configure custom CSS, JavaScript and localisation resources.
		CSSPaths {
			10 >
			50 >
			70 >
		}

		JSPaths {
			10 = EXT:tmpl_adw/Resources/Public/JavaScript/find.js
			50 = EXT:tmpl_adw/Resources/Public/JavaScript/Resikom.js
		}

		#languageRootPath = EXT:find/Projects/edfu/Language/
		languageRootPath = EXT:tmpl_adw/Resources/Private/Language/Resikom/
		jumpToID >
	}

	felogin < plugin.tx_felogin_pi1
	felogin {
		storagePid = {$plugin.tx_find.felogin.storagePid}
	}
}
